\ProvidesPackage{plotpolicies}
\usepackage{ifthen}

\newcommand{\plotPolicies}[2]{
\begin{tikzpicture}
\pgfplotsset{
      scale only axis,
      date coordinates in=x,
      xticklabel=\day/\month,
      height=2cm,
    }
    \begin{groupplot}[
    group style={
            % set how the plots should be organized
            group size=2 by 10,
            % only show ticklabels and axis labels on the bottom
            y descriptions at=edge left,
            x descriptions at=edge bottom,
            % set the `vertical sep' to zero
            horizontal sep=0pt,
            vertical sep=0pt
        },
      width=4.75cm,
      axis y line*=left,
      xlabel={time},
      ylabel={people},
    ]
    \pgfplotsforeachungrouped \p in {#1, ..., #2} {
    \edef\tmp{
        \noexpand\nextgroupplot[scaled y ticks=false]
        \noexpand\addplot[mark=none, cyan] table [x=dates, y=i_hosp_new, col sep=comma] {data/ode/policy_\p.csv};
        \noexpand\label{i_hosp_new}
        \noexpand\addplot[mark=none, orange] table [x=dates, y=i_icu_new, col sep=comma] {data/ode/policy_\p.csv};
        \noexpand\label{i_icu_new}
        \noexpand\addplot[mark=none, red] table [x=dates, y=d_new, col sep=comma] {data/ode/policy_\p.csv};
        \noexpand\label{d_new}
        }
        \tmp
    }
    \end{groupplot}
    
    \begin{groupplot}[
    group style={
            % set how the plots should be organized
            group size=2 by 10,
            % only show ticklabels and axis labels on the bottom
            y descriptions at=edge right,
            x descriptions at=edge bottom,
            % set the `vertical sep' to zero
            horizontal sep=0pt,
            vertical sep=0pt
        },
      width=4.75cm,
      axis y line*=right,
      axis x line=none,
      ymax=1.1,
      ylabel={proportion},
      legend style={at={(0.5,1)},anchor=south},
      legend columns=3, 
      legend cell align=left,
    ]
    \pgfplotsforeachungrouped \p in {#1, ..., #2}{
    \edef\tmp{
        \noexpand\nextgroupplot[scaled y ticks=false]
        \noexpand\addplot[mark=none, dashed, blue] table [x=dates, y=p_w, col sep=comma] {data/ode/policy_\p.csv};
        \noexpand\label{p_w}
        \noexpand\addplot[mark=none, dashed, magenta] table [x=dates, y=p_s, col sep=comma] {data/ode/policy_\p.csv};
        \noexpand\label{p_s}
        \noexpand\addplot[mark=none, dashed, darkgray] table [x=dates, y=p_l, col sep=comma] {data/ode/policy_\p.csv};
        \noexpand\label{p_l}
        }
        \tmp
    }
    \label{p_l}
    \end{groupplot}
  \end{tikzpicture}
}

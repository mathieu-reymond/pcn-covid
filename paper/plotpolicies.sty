\ProvidesPackage{plotpolicies}
\usepackage{ifthen}

\newcommand{\plotPolicies}[3]{
\begin{tikzpicture}
\pgfplotsset{
      scale only axis,
      date coordinates in=x,
      xticklabel=\day/\month,
      height=2cm,
    }
    \begin{groupplot}[
    group style={
            % set how the plots should be organized
            group size=2 by 10,
            % only show ticklabels and axis labels on the bottom
            y descriptions at=edge left,
            x descriptions at=edge bottom,
            % set the `vertical sep' to zero
            horizontal sep=0pt,
            vertical sep=0pt
        },
      width=6.75cm,
      axis y line*=left,
      xlabel={time},
      ylabel={individuals},
      y tick label style={/pgf/number format/sci}
    ]
    \def\allruns{}
    \pgfplotsforeachungrouped \p in {#1, ..., #2} {
      \eappto\allruns{
        \noexpand\nextgroupplot[scaled y ticks=false]
      }
      \pgfplotsforeachungrouped \r in {0, ..., 9} {
        \eappto\allruns{
          \noexpand\addplot[mark=none, cyan!50] table [x=dates, y=i_hosp_new, col sep=comma] {data/transitions/arh/binomial/budget_#3/policies-transitions/\p/run_\r.csv};
          \noexpand\label{i_hosp_new}
          \noexpand\addplot[mark=none, orange!50] table [x=dates, y=i_icu_new, col sep=comma] {data/transitions/arh/binomial/budget_#3/policies-transitions/\p/run_\r.csv};
          \noexpand\label{i_icu_new}
          \noexpand\addplot[mark=none, red!50] table [x=dates, y=d_new, col sep=comma] {data/transitions/arh/binomial/budget_#3/policies-transitions/\p/run_\r.csv};
          \noexpand\label{d_new}
        }
      }
    }
    \allruns
    \end{groupplot}
    
    \begin{groupplot}[
    group style={
            % set how the plots should be organized
            group size=2 by 10,
            % only show ticklabels and axis labels on the bottom
            y descriptions at=edge right,
            x descriptions at=edge bottom,
            % set the `vertical sep' to zero
            horizontal sep=0pt,
            vertical sep=0pt
        },
      width=6.75cm,
      axis y line*=right,
      axis x line=none,
      ymax=1.1,
      ylabel={proportion},
      legend style={at={(0.5,1)},anchor=south},
      legend columns=3, 
      legend cell align=left,
    ]
    \def\allruns{}
    \pgfplotsforeachungrouped \p in {#1, ..., #2} {
      \eappto\allruns{
        \noexpand\nextgroupplot[scaled y ticks=false]
      }
      \pgfplotsforeachungrouped \r in {0, ..., 9} {
        \eappto\allruns{
          \noexpand\addplot[mark=none, dashed, blue!50] table [x=dates, y=p_w, col sep=comma] {data/transitions/arh/binomial/budget_#3/policies-transitions/\p/run_\r.csv};
          \noexpand\label{p_w}
          \noexpand\addplot[mark=none, dashed, magenta!50] table [x=dates, y=p_s, col sep=comma] {data/transitions/arh/binomial/budget_#3/policies-transitions/\p/run_\r.csv};
          \noexpand\label{p_s}
          \noexpand\addplot[mark=none, dashed, darkgray!50] table [x=dates, y=p_l, col sep=comma] {data/transitions/arh/binomial/budget_#3/policies-transitions/\p/run_\r.csv};
          \noexpand\label{p_l}
        }
      }
    }
    \allruns
    \end{groupplot}
  \end{tikzpicture}
}
